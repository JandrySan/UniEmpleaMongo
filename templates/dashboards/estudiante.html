<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Estudiante | UniEmplea</title>

    <style>
        body {
            margin: 0;
            font-family: Arial, Helvetica, sans-serif;
            background-color: #f4f6f8;
        }

        /* ===== HEADER ===== */
        header {
            background-color: #0d6efd;
            color: white;
            padding: 15px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        header h1 {
            margin: 0;
            font-size: 20px;
        }

        .menu {
            display: flex;
            gap: 10px;
        }

        .menu button {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .menu button:hover,
        .menu button.activo {
            background: white;
            color: #0d6efd;
        }

        .logout {
            background: #dc3545;
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
        }

        /* ===== CONTENEDOR ===== */
        .container {
            max-width: 1100px;
            margin: auto;
            padding: 30px;
        }

        /* ===== SECCIONES ===== */
        .seccion {
            display: none;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .card h2 {
            margin-top: 0;
            color: #0d6efd;
        }

        .tag {
            padding: 4px 10px;
            border-radius: 12px;
            background: #e7f1ff;
            color: #0d6efd;
            font-weight: bold;
        }

        .oferta {
            border-bottom: 1px solid #ddd;
            padding: 15px 0;
        }

        .oferta:last-child {
            border-bottom: none;
        }

        button {
            padding: 6px 14px;
            background-color: #0d6efd;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0b5ed7;
        }

        .notificacion {
            background: #e7f9f0;
            color: #0f5132;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 6px;
            border-left: 5px solid #198754;
        }

        .recomendacion {
            background: #fafafa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 12px;
            border-left: 4px solid #0d6efd;
        }

        .btn-postular {
            background-color: #007bff;
            color: white;
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .btn-postular:hover {
            background-color: #0056b3;
        }

        .btn-postulado {
            background-color: #28a745;
            color: white;
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            cursor: not-allowed;
            opacity: 0.8;
        }
        .btn {
            padding: 8px 14px;
            border-radius: 6px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        /* Botón Postular */
        .btn-postular {
            background-color: #0d6efd; 
            color: white;
        }

        .btn-postular:hover {
            background-color: #0b5ed7;
        }

        /* Botón Ya postulado */
        .btn-postulado {
            background-color: #6c757d; 
            color: white;
            cursor: not-allowed;
        }

    </style>
</head>

<body>

<header>
    <h1>Panel del Estudiante</h1>

    <nav class="menu">
        <button onclick="mostrarSeccion('estado', this)">Estado</button>
        <button onclick="mostrarSeccion('notificaciones', this)">Notificaciones</button>
        <button onclick="mostrarSeccion('laborales', this)">Ofertas</button>
        <button onclick="mostrarSeccion('practicas', this)">Prácticas</button>
        <button onclick="mostrarSeccion('cv', this)">Mi CV</button>
        <button onclick="mostrarSeccion('recomendaciones', this)">Recomendaciones</button>
    </nav>

    <a href="{{ url_for('auth.logout') }}" class="logout"
       onclick="return confirm('¿Desea cerrar sesión?')">
        Cerrar sesión
    </a>
</header>

<div class="container">

    <!-- ESTADO -->
    <div class="card seccion" id="estado">
        <h2>Tu Estado Académico</h2>
        <p><strong>Semestre:</strong> {{ usuario.semestre }}</p>
        <p><strong>Estado de prácticas:</strong>
            <span class="tag">{{ estado_practicas }}</span>
        </p>
    </div>

    <!-- NOTIFICACIONES -->
    <div class="card seccion" id="notificaciones">
        <h2>Notificaciones</h2>
        {% if notificaciones %}
            {% for notif in notificaciones %}
                <div class="notificacion">{{ notif.mensaje }}</div>
            {% endfor %}
        {% else %}
            <p>No tienes notificaciones.</p>
        {% endif %}
    </div>

    <!-- OFERTAS LABORALES -->
    <div class="card seccion" id="laborales">
        <h2>Ofertas Laborales</h2>

        {% if ofertas_laborales %}
            {% for oferta in ofertas_laborales %}
            <div class="oferta">
                <h3>{{ oferta.titulo }}</h3>
                <p>{{ oferta.descripcion }}</p>

                <p>
                    <strong>Ciudad:</strong> {{ oferta.ciudad or 'No especificada' }} |
                    <strong>Modalidad:</strong> {{ oferta.modalidad }} |
                    <strong>Jornada:</strong> {{ oferta.jornada }}
                </p>

                <p>
                    <strong>Salario:</strong> {{ oferta.salario or 'A convenir' }} |
                    <strong>Tipo:</strong> {{ oferta.tipo }}
                </p>

                {% if oferta.ya_postulado %}
                    <strong>Estado:</strong>
                    {% if oferta.estado_postulacion == 'aceptado' %}
                        <span class="badge badge-success">Aceptado</span>
                    {% elif oferta.estado_postulacion == 'cancelada' %}
                        <span class="badge badge-secondary">
                            Cancelado (aceptado en otra empresa)
                        </span>
                    {% elif oferta.estado_postulacion == 'rechazado' %}
                        <span class="badge badge-danger">Rechazado</span>
                    {% else %}
                        <span class="badge badge-warning">En revisión</span>
                    {% endif %}
                {% else %}
                    <form method="POST"
                        action="{{ url_for('estudiante.postular_oferta', oferta_id=oferta.id) }}">
                        <button class="btn btn-primary">Postular</button>
                    </form>
                {% endif %}
            </div>
            {% endfor %}


        {% else %}
            <p>No hay ofertas laborales.</p>
        {% endif %}
    </div>


    <!-- PRÁCTICAS -->
    <div class="card seccion" id="practicas">
        <h2>Prácticas Profesionales</h2>

        {% if usuario.semestre < 7 %}
            <p>Debes estar en 7mo semestre o superior.</p>

        {% elif not usuario.solicitud_practica %}
            <p>Aún no has solicitado prácticas.</p>
            <a href="{{ url_for('estudiante.practicas') }}">
                <button>Solicitar</button>
            </a>

        {% elif usuario.solicitud_practica and not usuario.practica_aprobada %}
            <p>Solicitud enviada. En espera de aprobación.</p>

        {% elif usuario.practica_aprobada and empresa_practica and oferta_practica %}
            <div class="card">
                <h3>Práctica Asignada</h3>
                <p><strong>Empresa:</strong> {{ empresa_practica.nombre }}</p>
                <p><strong>Oferta:</strong> {{ oferta_practica.titulo }}</p>
            </div>

        {% else %}
            {% if ofertas_practicas %}
                {% for oferta in ofertas_practicas %}
                <div class="oferta">
                    <h3>{{ oferta.titulo }}</h3>
                    <p>{{ oferta.descripcion }}</p>

                    <p>
                        <strong>Ciudad:</strong> {{ oferta.ciudad or 'No especificada' }} |
                        <strong>Modalidad:</strong> {{ oferta.modalidad }} |
                        <strong>Jornada:</strong> {{ oferta.jornada }}
                    </p>

                    {% if oferta.ya_postulado %}
                        <strong>Estado:</strong>
                        {% if oferta.estado_postulacion == 'aceptado' %}
                            <span class="badge badge-success">Aceptado</span>
                        {% elif oferta.estado_postulacion == 'cancelada' %}
                            <span class="badge badge-secondary">
                                Cancelado (aceptado en otra empresa)
                            </span>
                        {% else %}
                            <span class="badge badge-warning">En revisión</span>
                        {% endif %}
                    {% else %}
                        <form method="POST"
                            action="{{ url_for('estudiante.postular_oferta', oferta_id=oferta.id) }}">
                            <button class="btn btn-primary">Postular</button>
                        </form>
                    {% endif %}
                </div>
                {% endfor %}


            {% else %}
                <p>No hay prácticas disponibles.</p>
            {% endif %}
        {% endif %}
    </div>


   
    <!-- CURRÍCULUM VITAE -->

    <div class="card seccion" id="cv">
        <h2>Currículum Vitae</h2>

        {% if usuario.cv_path %}
            <p class="tag">CV cargado</p>

            <a href="{{ url_for('static', filename=usuario.cv_path) }}"
            target="_blank">
                <button>Ver CV</button>
            </a>

            <form method="POST"
                action="{{ url_for('estudiante.eliminar_cv_estudiante') }}"
                style="display:inline;"
                onsubmit="return confirm('¿Eliminar CV?');">
                <button style="background:#dc3545;">Eliminar</button>
            </form>
        {% else %}
            <p>No has subido tu CV</p>
        {% endif %}

        <form method="POST"
            action="{{ url_for('estudiante.subir_cv_estudiante') }}"
            enctype="multipart/form-data">
            <input type="file" name="cv" accept=".pdf" required>
            <button>Subir CV</button>
        </form>
    </div>


    
    <!-- RECOMENDACIONES -->

    <div class="card seccion" id="recomendaciones">
        <h2>Recomendaciones</h2>

        {% if recomendaciones %}
            {% for r in recomendaciones %}
            <div class="card">
                <p><strong>Docente:</strong> {{ r.docente_nombre }}</p>

                <p><strong>Mensaje:</strong> {{ r.mensaje_docente }}</p>

                {% if r.estado == "pendiente" %}
                <form method="POST"
                    action="{{ url_for('estudiante.marcar_recomendacion_respondida',
                                        recomendacion_id=r.id) }}">
                    <button>Marcar como respondida</button>
                </form>
                {% else %}
                <span style="color:green;"> Ya respondida</span>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <p>No tienes recomendaciones.</p>
        {% endif %}
    </div>


</div>

<script>
function mostrarSeccion(id, boton) {
    document.querySelectorAll('.seccion').forEach(sec => {
        sec.style.display = 'none';
    });

    document.getElementById(id).style.display = 'block';

    document.querySelectorAll('.menu button').forEach(btn => {
        btn.classList.remove('activo');
    });

    boton.classList.add('activo');
}

document.addEventListener("DOMContentLoaded", () => {
    const primerBoton = document.querySelector(".menu button");
    primerBoton.click();
});
</script>

</body>
</html>
